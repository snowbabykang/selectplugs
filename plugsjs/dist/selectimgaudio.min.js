!function(a){var b="selectAudio",c={host:"",backdatainfo:function(){}},d=function(b,d){this.$ele=a(b),this.options=a.extend({},c,d),this.init()};d.prototype={initDom:function(){return this.$total="",this.$totalPage="",this.$curPage=1,this.$listdata_obj="",this.$listdata_arr=[],this.uploadermusic="",this.$getallaudios=this.options.host+"/index.php/shangjia/commoncomponent/getallaudios",this.$getsingleaudio=this.options.host+"/index.php/shangjia/commoncomponent/getsingleaudio",this},init:function(){return this.initDom().create(),this},create:function(){var b=this,c=[];c[0]='<div id="myAudioModal" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><h3>选择音频<span class="font12 red mlr05">支持mp3格式且单个音频大小不能超过5M</span></h3></div><div class="modal-body m-body"><div class="classifylist fl m-body-l"><div class="input-append"><input type="text" placeholder="输入分类名称" class="searchaudio"><span class="btn saudiobtn">搜索</span></div><div id="audiocatelist" class="scrollbar"></div></div><div class="fl m-body-r"><audio loop="" src="" id="mymedia" autoplay="" preload=""></audio><div id="webuploadmusic"><div id="musicPicker">选择音乐</div></div><div id="myaudiolist" class="scrollbar"></div><div class="prdpagecount"></div></div></div><div class="modal-footer"><button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button></div></div>';var d=a("body").find("#myAudioModal").length;return 0>=d&&a(document.body).append(c[0]),b.$modalHTML=a("body").find("#myAudioModal"),b.setDom(),this},setDom:function(){return this.$searchinput=this.$modalHTML.find(".searchaudio"),this.$searchbtn=this.$modalHTML.find(".saudiobtn"),this.$classifylist=this.$modalHTML.find("#audiocatelist"),this.$contentlist=this.$modalHTML.find("#myaudiolist"),this.$singleconfirmbtn=this.$modalHTML.find("#myaudiolist li"),this.$pagecontent=this.$modalHTML.find(".prdpagecount"),this.$pagebtn=this.$modalHTML.find(".prdpagecount span a"),this},show:function(){return this.$modalHTML.modal("show"),this},hide:function(){return this.$modalHTML.modal("hide"),this},getcurrentcid:function(){var a=this.$ele.attr("data-classfiy");return a||(a=this.$classifylist.find("ul>li:first-child").attr("data-id")),a},initdata:function(){this.itemlist();var a=this.getcurrentcid();return this.$classifylist.find("li[data-id="+a+"]").addClass("active"),this.plugslistinit(this.$getsingleaudio,a),this},plugslistinit:function(a,b){this.$pagebtn.die("click"),this.getplugmainlist(1,a,b),this.ajaxpagemainlist(a,b)},itemlist:function(b){var c=this;a.ajax({type:"POST",url:c.$getallaudios,data:{title:b},dataType:"json",async:!1,beforeSend:function(){c.$classifylist.html("<div class='dataloading'>加载中...</div>")},success:function(b){if("40001"==b.status)c.$classifylist.html("");else{var d="",e=b.info;a.each(e,function(b,c){d+='<li data-id="'+c.id+'" title="'+c.audio_desc+'">'+c.name+"<code>"+c.audio_num+"</code></li>",c.sub.length>0&&a.each(c.sub,function(a,b){d+='<li class="item_sub" data-id="'+b.id+'" title="'+c.audio_desc+'" rel="'+c.parent_id+'">'+b.name+"<code>"+b.audio_num+"</code></li>"})}),c.$classifylist.html("<ul>"+d+"</ul>");var f=c.$searchinput.val();f=a.trim(f),a.hilightEle(c.$classifylist,f)}}})},getplugmainlist:function(b,c,d){var e=this;a.ajax({type:"POST",url:c,data:{page:b,id:d},dataType:"json",beforeSend:function(){e.$contentlist.html("<div class='dataloading'>加载中...</div>"),e.$pagecontent.hide()},success:function(c){if("40001"==c.status)e.$contentlist.html("<div class='datawarn'>登陆超时，请<span class='btn-link' onclick='location.reload();'>刷新</span>页面重新登陆</div>"),e.$pagecontent.hide();else if(e.$contentlist.empty(),e.uploadermusic.options.formData.audioid=d,0==c.count)e.$contentlist.html("<div class='datawarn'>没有数据</div>"),e.$pagecontent.hide();else{c.countpage>1&&(e.$pagecontent.show(),e.$total=c.count,e.$totalPage=c.countpage,e.$curPage=b);var f='<table style="width:100%;"><tr><th>音频</th><th>时长</th><th>大小</th><th>操作</th></tr>',g="",h=c.info;a.each(h,function(a,b){g+='<tr><td><span class="audioplay" audio="'+b.audiourl+'"></span><span class="audio_title" title="'+b.audio_name+'">'+b.audio_name+"</span></td><td>"+b.timelong+"</td><td>"+b.filesize+'M</td><td><a href="javascript:void(0);" class="btn-link selaudiobtn" data-time="'+b.timelong+'" data-baseurl="'+b.base64url+'" data-size="'+b.filesize+'" data-title="'+b.audio_name+'" data-url="'+b.audiourl+'">选择</a></td></tr>'});var i="</table>";e.$contentlist.html(f+g+i);var j=e.$classifylist.find("li.active").find("code").html();j!==c.count&&e.$classifylist.find("li.active").find("code").html(c.count)}},complete:function(){var b=a.getPageBar(e.$curPage,e.$totalPage,e.$total);e.$pagecontent.html(b)},error:function(){e.$contentlist.html("<div class='datawarn'>数据加载失败</div>"),e.$pagecontent.hide()}})},ajaxpagemainlist:function(b,c){var d=this;d.$pagebtn.live("click",function(){var e=a(this).attr("rel");e&&d.getplugmainlist(e,b,c)})},execSearch:function(b){var c=this;""==a.trim(b)?c.itemlist():(b=a.trim(b),c.itemlist(b))},bindEvent:function(){var b=this,c=b.$ele;return b.$classifylist.undelegate(),b.$classifylist.delegate("li","click",function(d){var e=a(this),f=e.attr("data-id");c.attr("data-classfiy",f),b.plugslistinit(b.$getsingleaudio,f),e.parent().children("li").removeClass("active"),e.addClass("active")}),b.$searchbtn&&(b.$searchbtn.die(),b.$searchbtn.live("click",function(){var c=a(this).prev().val();b.execSearch(c)}),b.$searchinput.live("keyup change",function(c){var d=a(this).val(),d=a.trim(d);d&&a.hilightEle(b.$classifylist,d),13==c.keyCode&&b.execSearch(d)})),a.isFunction(b.options.backdatainfo)&&(b.$contentlist.undelegate(),b.$contentlist.delegate(".selaudiobtn","click",function(d){d.preventDefault();var e=a(this),f=e.attr("data-title"),g=e.attr("data-url"),h=e.attr("data-baseurl"),i=e.attr("data-size"),j=e.attr("data-time");b.$listdata_obj={baseurl:h,size:i,url:g,title:f,time:j};b.$classifylist.find("li.active").attr("data-id");b.options.backdatainfo(c,b.$listdata_obj),b.hide()})),b.$contentlist.delegate(".audioplay","click",function(){var c=a(this).attr("audio");a(this).hasClass("play")?(a(this).removeClass("play"),document.getElementById("mymedia").pause()):(b.$modalHTML.find("#mymedia").attr("src",c),a(this).addClass("play"),a(this).parents("tr").siblings().find(".audioplay").removeClass("play"),document.getElementById("mymedia").play())}),b.uploadermusic||b.webuploader(),this},webuploader:function(){var b=this,c=a("#webuploadmusic");b.uploadermusic=WebUploader.create({formData:{audioid:""},auto:!0,swf:b.options.host+"/webuploader/dist/Uploader.swf",server:b.options.host+"/uploadify/UploadAudio.php",pick:{id:"#musicPicker",multiple:!1},accept:{title:"音乐",extensions:"amr,mp3,wma,wav",mimeTypes:".amr,.mp3,.wma,.wav"},duplicate:!0,fileSingleSizeLimit:5242880}),b.uploadermusic.on("fileQueued",function(a){c.append("<div class='uploadbox'><p class='uploadtitle'>"+a.name+"</p></div>")}),b.uploadermusic.on("uploadProgress",function(b,d){var e=c.find(".uploadprogress span"),f=c.find(".uploadbox");e.length||(e=a('<p class="uploadprogress"><span></span></p>').appendTo(f).find("span")),e.css({width:100*d+"%",display:"block"})}),b.uploadermusic.on("uploadSuccess",function(a,c){var d=b.$classifylist.find("li.active").data("id");if(b.plugslistinit(b.$getsingleaudio,d),c._raw.indexOf("err")>-1){var e=c._raw.substr(6);alert(e)}else alert("上传成功!")}),b.uploadermusic.on("uploadError",function(a){alert("上传失败")}),b.uploadermusic.on("uploadComplete",function(a){c.find(".uploadbox").remove()}),b.uploadermusic.onError=function(a){alert("Eroor: "+a)}}};var e=a.fn[b];a.fn[b]=function(c){return this.each(function(){var e=a(this),f=e.data("selectPlugsData"),g=a.fn[b].pluginData[f],h="object"==typeof c&&c;g||(f=a.fn[b].pluginData.index++,a.fn[b].pluginData[f]=new d(this,h),e.data("selectPlugsData",f),g=a.fn[b].pluginData[f]),g.initdata().bindEvent().show()})},a.fn[b].pluginData={index:0},a.fn[b].Constructor=b,a.fn[b].noConflict=function(){return a.fn[b]=e,this},a(document).ready(function(){a('[data-plug="'+b+'"]').each(function(){var c=a(this),d=this.dataset;a.fn[b].call(c,d)})}),d.version="1.0.0"}($);
!function($){var pluginName="selectPic",defaults={host:"",num:1,reset:!1,backdatainfo:function(){}},SelectPic=function(a,b){this.$ele=$(a),this.options=$.extend({},defaults,b),this.init()};SelectPic.prototype={initDom:function(){return this.$total="",this.$totalPage="",this.$curPage=1,this.$listdata_obj="",this.$listdata_arr=[],this.$getallalbums=this.options.host+"/index.php/shangjia/commoncomponent/getallalbums",this.$getsinglealbumpic=this.options.host+"/index.php/shangjia/commoncomponent/getsinglealbumpic",this.$getlocalimgurl=this.options.host+"/index.php/shangjia/picture/grabpic",this},init:function(){var a=/^\d+$/.test(this.options.num);return a?(this.initDom().create(),this):(alert("请填写正确的选择数量的参数"),!1)},create:function(){var a=this,b=[];b[0]='<div id="myAlbumModal" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-header" style="padding-bottom: 0;border-bottom: none;"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><h3 style="padding-bottom:10px;">选择图片<span class="font12 red mlr05">可以批量上传图片，一次最多能上传20张图片,支持截屏黏贴图片；右侧可以上传本地图片到相册,支持(jpg,png,jpeg,JPG,PNG,JPEG)，不得超过2MB</span></h3></div><div class="modal-body m-body" style="height:400px;"><div class="classifylist fl m-body-l"><div class="input-append"><input type="text" placeholder="输入相册名称" class="searchalbum"><span class="btn salbumbtn">搜索</span></div><div id="catepagelist" class="scrollbar"></div></div><div class="fl m-body-c"><div id="myalbumlist" class="scrollbar"></div><div class="prdpagecount"></div></div><div id="uploadpic" class="fl scrollbar m-body-r"><div id="uploader"><div class="queueList scrollbar"><div id="dndArea" class="placeholder"><div id="filePicker"></div></div></div><div class="statusBar" style="display:none;"><div class="progress"><span class="text">0%</span><span class="percentage"></span></div><div class="info"></div><div class="btns"><div id="filePicker2"></div><div class="uploadBtn">开始上传</div></div></div></div></div></div><div class="modal-footer"><button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button><button class="btn btn-primary picsubmit">确定<span class="selectednum"></span></button></div></div>';var c=$("body").find("#myAlbumModal").length;return 0>=c&&$(document.body).append(b[0]),a.$modalHTML=$("body").find("#myAlbumModal"),a.setDom(),this},setDom:function(){return this.$searchinput=this.$modalHTML.find(".searchalbum"),this.$searchbtn=this.$modalHTML.find(".salbumbtn"),this.$interimg=this.$modalHTML.find(".interimg"),this.$interimgbtn=this.$modalHTML.find(".addexternalimg"),this.$classifylist=this.$modalHTML.find("#catepagelist"),this.$contentlist=this.$modalHTML.find("#myalbumlist"),this.$singleconfirmbtn=this.$modalHTML.find("#myalbumlist li"),this.$multiselectbtn=this.$modalHTML.find(".picsubmit"),this.$multiselectnum=this.$modalHTML.find(".selectednum"),this.$pagecontent=this.$modalHTML.find(".prdpagecount"),this.$pagebtn=this.$modalHTML.find(".prdpagecount span a"),this.$multiselectnum&&this.$multiselectnum.html(""),this},show:function(){return this.$modalHTML.modal("show"),this},hide:function(){return this.$modalHTML.modal("hide"),this},replaceimg:function(a,b){if("1"==b){var c=a.indexOf("http://img.midite.com/");return c>=0&&(a=a.replace(/\http:\/\/img.midite.com\//g,"http://img1.midite.com/")),a}if("2"==b){var c=a.indexOf("http://img1.midite.com/");return c>=0&&(a=a.replace(/\http:\/\/img1.midite.com\//g,"http://img.midite.com/")),a}},getcurrentcid:function(){var a=this.$ele.attr("data-classfiy");return a||(a=this.$classifylist.find("ul>li:first-child").attr("data-id")),a},initdata:function(){this.$interimg.val(""),this.$listdata_arr=[],this.itemlist();var a=this.getcurrentcid();return this.albumId=a,this.webuploader(),this.$classifylist.find("li[data-id="+a+"]").addClass("active"),this.plugslistinit(this.$getsinglealbumpic,a),this},plugslistinit:function(a,b){this.$pagebtn.die("click"),this.getplugmainlist(1,a,b),this.ajaxpagemainlist(a,b)},itemlist:function(a){var b=this;$.ajax({type:"POST",url:b.$getallalbums,data:{title:a},dataType:"json",async:!1,beforeSend:function(){b.$classifylist.html("<div class='dataloading'>加载中...</div>")},success:function(a){if("40001"==a.status)b.$classifylist.html("");else if(0==a.count)b.$classifylist.html("<div class='datawarn'>没有这个分类</div>");else{var c="",d=a.info;$.each(d,function(a,b){c+='<li data-id="'+b.id+'" title="'+b.album_desc+'">'+b.name+"<code>"+b.picture_num+"</code></li>",b.sub&&b.sub.length>0&&$.each(b.sub,function(a,d){c+='<li class="item_sub" data-id="'+d.id+'" title="'+b.album_desc+'" rel="'+b.parent_id+'">'+d.name+"<code>"+d.picture_num+"</code></li>"})}),b.$classifylist.html("<ul>"+c+"</ul>");var e=b.$searchinput.val();e=$.trim(e),$.hilightEle(b.$classifylist,e)}}})},getplugmainlist:function(a,b,c){var d=this;$.ajax({type:"POST",url:b,data:{page:a,id:c},dataType:"json",beforeSend:function(){d.$contentlist.html("<div class='dataloading'>加载中...</div>"),d.$pagecontent.hide()},success:function(b){if("40001"==b.status)d.$contentlist.html("<div class='datawarn'>登陆超时，请<span class='btn-link' onclick='location.reload();'>刷新</span>页面重新登陆</div>"),d.$pagecontent.hide();else{d.$contentlist.empty();var e=parseInt(b.max_num)-parseInt(b.count);if(e=e>=20?20:0>=e?0:e,d.albumId=c,uploader.options&&(uploader.options.formData.album=d.albumId,uploader.options.fileNumLimit=e,uploader.options.fileSizeLimit=2*e*1024*1024),0==b.count)d.$contentlist.html("<div class='datawarn'>没有数据</div>"),d.$pagecontent.hide();else{b.countpage>1&&(d.$pagecontent.show(),d.$total=b.count,d.$totalPage=b.countpage,d.$curPage=a);var f="",g=b.info;$.each(g,function(a,c){f+='<li data-url="'+c.picurl+'" rel="'+b.albumdir+'" title="'+c.pic_name+'" data-base="'+c.base64url+'"><div class="imgboxhidden"><img src="'+c.picurl+'_180x180.jpg"/></div><span class="imgtitle"  title="'+c.pic_name+'">'+c.pic_name+"</span></li>"}),f=d.replaceimg(f,1),d.$contentlist.html("<ul>"+f+"</ul>");var h=d.$listdata_arr.length;if(h>0)for(var i=0;h>i;i++){var j=d.$listdata_arr[i].url;d.$contentlist.find("li").each(function(){var a=$(this).attr("data-url");a=d.replaceimg(a,1),j==a&&d.$contentlist.find("li[data-url='"+j+"']").addClass("active")})}var k=d.$classifylist.find("li.active").find("code").html();k!==b.count&&d.$classifylist.find("li.active").find("code").html(b.count)}}},complete:function(){var a=$.getPageBar(d.$curPage,d.$totalPage,d.$total);d.$pagecontent.html(a)},error:function(){d.$contentlist.html("<div class='datawarn'>数据加载失败</div>"),d.$pagecontent.hide()}})},ajaxpagemainlist:function(a,b){var c=this;c.$pagebtn.live("click",function(){var d=$(this).attr("rel");d&&c.getplugmainlist(d,a,b)})},checkedEle:function(a,b,c,d){var e=this;if(a.hasClass("active")){a.removeClass("active");var f=a.attr("data-base");$.removeItem(c,f,"baseurl")}else 0==d?(a.addClass("active"),-1==jQuery.inArray(b,c)&&c.push(b)):c.length<d?(a.addClass("active"),-1==jQuery.inArray(b,c)&&c.push(b)):alert("您最多选择"+d+"个");e.$multiselectnum.html("("+c.length+")")},execSearch:function(a){var b=this;""==$.trim(a)?b.itemlist():(a=$.trim(a),b.itemlist(a))},bindEvent:function(){var _this=this,ele=_this.$ele,num=_this.options.num;return _this.$classifylist.undelegate(),_this.$classifylist.delegate("li","click",function(a){var b=$(this),c=b.attr("data-id");ele.attr("data-classfiy",c),_this.plugslistinit(_this.$getsinglealbumpic,c),b.parent().children("li").removeClass("active"),b.addClass("active")}),_this.$searchbtn&&(_this.$searchbtn.die(),_this.$searchbtn.live("click",function(){var a=$(this).prev().val();_this.execSearch(a)}),_this.$searchinput.live("keyup change",function(a){var b=$(this).val(),b=$.trim(b);b&&$.hilightEle(_this.$classifylist,b),13==a.keyCode&&_this.execSearch(b)})),$.isFunction(_this.options.backdatainfo)&&(_this.$contentlist.undelegate(),_this.$contentlist.delegate("li","click",function(a){a.preventDefault();var b=$(this),c=b.attr("title"),d=b.attr("data-url"),e=b.attr("data-base"),f=b.attr("rel");_this.$listdata_obj={baseurl:e,rel:f,url:d,title:c};_this.$classifylist.find("li.active").attr("data-id");return 1==num?(_this.options.backdatainfo(ele,_this.$listdata_obj),_this.hide(),!1):void _this.checkedEle(b,_this.$listdata_obj,_this.$listdata_arr,num)}),_this.$multiselectbtn.unbind(),_this.$multiselectbtn.bind("click",function(){var a=_this.$listdata_arr.length;return a>0?(_this.options.backdatainfo(ele,_this.$listdata_arr),void _this.hide()):(alert("请选择图片"),!1)})),_this.$interimgbtn.unbind(),_this.$interimgbtn.bind("click",function(){var img=$(this).prev().val(),infop=$(this).parent().next(".red");img?$.ajax({type:"POST",url:_this.$getlocalimgurl,data:{img_link:img},success:function(data){var data=eval("("+data+")");return 1==data.code?(infop.show().html(data.msg),!1):(infop.hide(),_this.$listdata_obj={baseurl:"",rel:"",url:data.msg,title:"外部图片"},_this.options.backdatainfo(ele,_this.$listdata_obj),_this.hide(),void 0)}}):($(this).prev().focus(),infop.show().html("请输入外部图片链接"))}),this},webuploader:function(){function a(a){var b=$('<li id="'+a.id+'"><p class="title">'+a.name+'</p><p class="imgWrap"></p><p class="progress"><span></span></p></li>'),c=$('<div class="file-panel"><span class="cancel">删除</span><span class="rotateRight">向右旋转</span><span class="rotateLeft">向左旋转</span></div>').appendTo(b),d=b.find("p.progress span"),e=b.find("p.imgWrap"),g=$('<p class="error"></p>'),h=function(a){switch(a){case"exceed_size":text="文件大小超出";break;case"interrupt":text="上传暂停";break;default:text="上传失败，请重试"}g.text(text).appendTo(b)};"invalid"===a.getStatus()?h(a.statusText):(e.text("预览中"),f.makeThumb(a,function(a,b){var c;return a?void e.text("不能预览"):void(x?(c=$('<img src="'+b+'">'),e.empty().append(c)):$.ajax("../../server/preview.php",{method:"POST",data:b,dataType:"json"}).done(function(a){a.result?(c=$('<img src="'+a.result+'">'),e.empty().append(c)):e.text("预览出错")}))},t,u),w[a.id]=[a.size,0],a.rotation=0),a.on("statuschange",function(e,f){"progress"===f?d.hide().width(0):"queued"===f&&(b.off("mouseenter mouseleave"),c.remove()),"error"===e||"invalid"===e?(h(a.statusText),w[a.id][1]=1):"interrupt"===e?h("interrupt"):"queued"===e?w[a.id][1]=0:"progress"===e?(g.remove(),d.css("display","block")):"complete"===e&&b.append('<span class="success"></span>'),b.removeClass("state-"+f).addClass("state-"+e)}),b.on("mouseenter",function(){c.stop().animate({height:30})}),b.on("mouseleave",function(){c.stop().animate({height:0})}),c.on("click","span",function(){var b,c=$(this).index();switch(c){case 0:return f.removeFile(a),void $("#dndArea").show();case 1:a.rotation+=90;break;case 2:a.rotation-=90}z?(b="rotate("+a.rotation+"deg)",e.css({"-webkit-transform":b,"-mos-transform":b,"-o-transform":b,transform:b})):e.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+~~(a.rotation/90%4+4)%4+")")}),b.appendTo(k)}function b(a){var b=$("#"+a.id);delete w[a.id],c(),b.off().find(".file-panel").off().end().remove()}function c(){var a,b=0,c=0,e=p.children();$.each(w,function(a,d){c+=d[0],b+=d[0]*d[1]}),a=c?b/c:0,e.eq(0).text(Math.round(100*a)+"%"),e.eq(1).css("width",Math.round(100*a)+"%"),d()}function d(){var a,b="";"ready"===v?b="选中"+q+"张图片，共"+WebUploader.formatSize(r)+"。":"confirm"===v?(a=f.getStats(),a.uploadFailNum&&(b="已成功上传"+a.successNum+"张照片至本地相册，"+a.uploadFailNum+'张照片上传失败，<a class="retry" href="#">重新上传</a>失败图片或<a class="ignore" href="#">忽略</a>')):(a=f.getStats(),b="共"+q+"张（"+WebUploader.formatSize(r)+"），已上传"+a.successNum+"张",a.uploadFailNum&&(b+="，失败"+a.uploadFailNum+"张")),m.html(b)}function e(a){var b;if(a!==v){switch(n.removeClass("state-"+v),n.addClass("state-"+a),v=a){case"pedding":o.removeClass("element-invisible"),k.hide(),l.addClass("element-invisible"),f.refresh();break;case"ready":o.hide(),$("#filePicker2").removeClass("element-invisible"),k.show(),l.removeClass("element-invisible"),f.refresh();break;case"uploading":$("#filePicker2").addClass("element-invisible"),p.show(),n.text("暂停上传");break;case"paused":p.show(),n.text("继续上传");break;case"confirm":if(p.hide(),$("#filePicker2").removeClass("element-invisible"),n.text("开始上传"),b=f.getStats(),b.successNum&&!b.uploadFailNum)return void e("finish");break;case"finish":b=f.getStats(),b.successNum?1==i?alert(j):alert("上传成功"):(v="done",location.reload())}d()}}var f,g=this,h=$("#uploader"),i="",j="",k=h.find(".queueList").find(".filelist").length<=0?$('<ul class="filelist"></ul>').appendTo(h.find(".queueList")):h.find(".filelist"),l=h.find(".statusBar"),m=l.find(".info"),n=h.find(".uploadBtn"),o=h.find(".placeholder"),p=l.find(".progress").hide(),q=0,r=0,s=window.devicePixelRatio||1,t=110*s,u=110*s,v="pedding",w={},x=function(){var a=new Image,b=!0;return a.onload=a.onerror=function(){(1!=this.width||1!=this.height)&&(b=!1)},a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==",b}(),y=function(){var a;try{a=navigator.plugins["Shockwave Flash"],a=a.description}catch(b){try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(c){a="0.0"}}return a=a.match(/\d+/g),parseFloat(a[0]+"."+a[1],10)}(),z=function(){var a=document.createElement("p").style,b="transition"in a||"WebkitTransition"in a||"MozTransition"in a||"msTransition"in a||"OTransition"in a;return a=null,b}();return l.hide(),o.show().removeClass("element-invisible"),h.find(".filelist").html(""),!WebUploader.Uploader.support("flash")&&WebUploader.browser.ie?void(y?!function(a){window.expressinstallcallback=function(a){switch(a){case"Download.Cancelled":alert("您取消了更新！");break;case"Download.Failed":alert("安装失败");break;default:alert("安装已成功，请刷新！")}delete window.expressinstallcallback};var b="./expressInstall.swf",c='<object type="application/x-shockwave-flash" data="'+b+'" ';WebUploader.browser.ie&&(c+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '),c+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+b+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>',a.html(c)}(h):h.html('<a href="http://www.adobe.com/go/getflashplayer" target="_blank" border="0"><img alt="get flash player" src="http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg" /></a>')):WebUploader.Uploader.support()?(f=WebUploader.create({pick:{id:"#filePicker",label:"本地上传图片"},formData:{is_weialbum:1,album:g.albumId},dnd:"#dndArea",paste:"#uploader",compress:!1,swf:g.options.host+"/webuploader/dist/Uploader.swf",chunked:!1,chunkSize:524288,server:g.options.host+"/uploadify/UploadImg.php",accept:{title:"Images",extensions:"jpg,jpeg,bmp,png,gif",mimeTypes:"image/*"},disableGlobalDnd:!0,fileNumLimit:200,fileSizeLimit:419430400,fileSingleSizeLimit:2097152}),f.on("uploadSuccess",function(a,b){if(i=b.code,j=b.msg,0==b.code){var c=g.$classifylist.find("li.active").data("id");g.plugslistinit(g.$getsinglealbumpic,c)}}),f.on("dndAccept",function(a){for(var b=!1,c=a.length,d=0,e="text/plain;application/javascript ";c>d;d++)if(~e.indexOf(a[d].type)){b=!0;break}return!b}),f.addButton({id:"#filePicker2",label:"继续添加"}),f.on("ready",function(){window.uploader=f}),f.onUploadProgress=function(a,b){var d=$("#"+a.id),e=d.find(".progress span");e.css("width",100*b+"%"),w[a.id][1]=b,c()},f.onFileQueued=function(b){q++,r+=b.size,1===q&&(o.addClass("element-invisible"),l.show()),a(b),e("ready"),c()},f.onFileDequeued=function(a){q--,r-=a.size,q||e("pedding"),b(a),c()},f.on("all",function(a){switch(a){case"uploadFinished":e("confirm");break;case"startUpload":e("uploading");break;case"stopUpload":e("paused")}}),f.onError=function(a){alert("Eroor: "+a)},n.on("click",function(){return $(this).hasClass("disabled")?!1:void("ready"===v?f.upload():"paused"===v?f.upload():"uploading"===v&&f.stop())}),m.on("click",".retry",function(){f.retry()}),m.on("click",".ignore",function(){alert("todo")}),n.addClass("state-"+v),c(),void $("#filePicker2").live("click",function(){var a;$(".filelist").find("li").each(function(){a=$(this).hasClass("state-complete")?!0:!1}),1==a&&f.reset()})):void alert("Web Uploader 不支持您的浏览器！")}};var old=$.fn[pluginName];$.fn[pluginName]=function(a){return this.each(function(){var b=$(this),c=!1,d=b.data("selectPlugsData"),e=$.fn[pluginName].pluginData[d],f="object"==typeof a&&a;f.reset?c=!0:e||(c=!0),c&&(d=$.fn[pluginName].pluginData.index++,$.fn[pluginName].pluginData[d]=new SelectPic(this,f),b.data("selectPlugsData",d),e=$.fn[pluginName].pluginData[d]),e.initdata().bindEvent().show()})},$.fn[pluginName].pluginData={index:0},$.fn[pluginName].Constructor=pluginName,$.fn[pluginName].noConflict=function(){return $.fn[pluginName]=old,this},$(document).ready(function(){$('[data-plug="'+pluginName+'"]').each(function(){var a=$(this),b=this.dataset;$.fn[pluginName].call(a,b)})}),SelectPic.version="1.0.0"}($);
