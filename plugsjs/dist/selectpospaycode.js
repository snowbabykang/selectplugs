!function(a){var b="selectPospaycode",c={host:"",num:1,storeid:"",serviceid:"",rulesign:0,backdatainfo:function(){}},d=function(b,d){this.$ele=a(b),this.options=a.extend({},c,d),this.init()};d.prototype={initDom:function(){return this.$total="",this.$totalPage="",this.$curPage=1,this.$listdata_obj="",this.$listdata_arr=[],this.$getqrcodeurl=this.options.host+"/index.php/shangjia/scanqrcodepay/qrcodelist",this.$creatnewurl=this.options.host+"/index.php/shangjia/scanqrcodepay/newscanqrcode",this},init:function(){var a=/^\d+$/.test(this.options.num);return a?(this.initDom().create(),this):(alert("请填写正确的选择数量的参数"),!1)},create:function(){var b=this,c=[];c[0]='<div id="MyposqrcodeModal" class="modal hide fade plugmodal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button><h3 class="fl">选择门店下收款码</h3><a href="'+b.$creatnewurl+'" class="btn btn-success fr" target="_blank" style="margin-right:20px;">新建收款码</a><span class="btn fr refreshbtn">刷新</span><div class="clearfix"></div></div><div class="modal-body"><div class="scrollbar linkbox plugmodallist" id="myqrcodelist"></div><div class="prdpagecount"></div></div><div class="modal-footer"><button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button><button class="btn btn-primary qrcodesubmit">确定<span class="qrcode_num"></span></button></div></div>';var d=a("body").find("#MyposqrcodeModal").length;return 0>=d&&a(document.body).append(c[0]),b.$modalHTML=a("body").find("#MyposqrcodeModal"),b.setDom(),this},setDom:function(){return this.$refreshbtn=this.$modalHTML.find(".refreshbtn"),this.$contentlist=this.$modalHTML.find("#myqrcodelist"),this.$singleconfirmbtn=this.$modalHTML.find(".selqrcodebtn"),this.$multiselectbtn=this.$modalHTML.find(".qrcodesubmit"),this.$multiselectnum=this.$modalHTML.find(".qrcode_num"),this.$pagecontent=this.$modalHTML.find(".prdpagecount"),this.$pagebtn=this.$modalHTML.find(".prdpagecount span a"),this.$multiselectnum&&this.$multiselectnum.html(""),this},show:function(){return this.$modalHTML.modal("show"),this},hide:function(){return this.$modalHTML.modal("hide"),this},initdata:function(){return this.plugslistinit(this.$getqrcodeurl),this},plugslistinit:function(a){this.$pagebtn.die("click"),this.getplugmainlist(1,a),this.ajaxpagemainlist(a)},getplugmainhtml:function(b){var c="",d='<table style="width:100%;"><tr><th>收款码名称</th><th>生成时间</th><th>关联员工</th><th width="80">操作</th></tr>',e="",f=b.list;a.each(f,function(a,b){e+='<tr data-id="'+b.qrc_id+'"><td><span class="plugtitle" title="'+b.qrc_name+'">'+b.qrc_name+"</span></td><td>"+b.qrc_create_time+"</td><td>"+b.qrc_bind_notice_staff_name+'</td><td><a href="javascript:void(0);" class="btn-link selqrcodebtn" data-id="'+b.qrc_id+'" data-title="'+b.qrc_name+'" data-time="'+b.qrc_create_time+'" data-staff="'+b.qrc_bind_notice_staff_name+'">选择</a></td></tr>'});var g="</table>";return c=d+e+g},getplugmainlist:function(b,c){var d=this;a.ajax({type:"POST",url:c,data:{page:b,store_id:d.options.storeid,service_id:d.options.serviceid,rule_sign:d.options.rulesign},dataType:"json",beforeSend:function(){d.$contentlist.html("<div class='dataloading'>加载中...</div>"),d.$pagecontent.hide()},success:function(a){if("40001"==a.status)d.$contentlist.html("<div class='datawarn'>登陆超时，请<span class='btn-link' onclick='location.reload();'>刷新</span>页面重新登陆</div>"),d.$pagecontent.hide();else if(d.$contentlist.empty(),0==a.pages)d.$contentlist.html("<div class='datawarn'>没有数据</div>"),d.$pagecontent.hide();else{a.pages>1&&(d.$pagecontent.show(),d.$total=a.total,d.$totalPage=a.pages,d.$curPage=b);var c=d.getplugmainhtml(a);d.$contentlist.html(c)}},complete:function(){var b=a.getPageBar(d.$curPage,d.$totalPage,d.$total);d.$pagecontent.html(b)},error:function(){d.$contentlist.html("<div class='datawarn'>数据加载失败</div>"),d.$pagecontent.hide()}})},ajaxpagemainlist:function(b){var c=this;c.$pagebtn.live("click",function(){var d=a(this).attr("rel");d&&c.getplugmainlist(d,b)})},checkedEle:function(b,c,d,e){var f=this;if("取消选择"==b.html()){b.html("选择");var g=b.attr("data-id");a.removeItem(d,g,"id")}else 0==e?(b.html("取消选择"),-1==jQuery.inArray(c,d)&&d.push(c)):d.length<e?(b.html("取消选择"),-1==jQuery.inArray(c,d)&&d.push(c)):alert("您最多选择"+e+"个");f.$multiselectnum.html("("+f.$listdata_arr.length+")")},bindEvent:function(){var b=this,c=b.$ele;return b.$refreshbtn.die(),b.$refreshbtn.live("click",function(){b.$multiselectnum&&b.$multiselectnum.html(""),b.initdata()}),a.isFunction(b.options.backdatainfo)&&(b.$singleconfirmbtn.die(),b.$singleconfirmbtn.live("click",function(){var d=a(this),e=d.attr("data-id"),f=d.attr("data-title"),g=d.attr("data-time"),h=d.attr("data-staff");return b.$listdata_obj={id:e,title:f,time:g,staff:h},1==b.options.num?(b.options.backdatainfo(c,b.$listdata_obj)!==!1&&b.hide(),!1):void b.checkedEle(d,b.$listdata_obj,b.$listdata_arr,b.options.num)}),1!==b.options.num&&(b.$multiselectbtn.unbind(),b.$multiselectbtn.bind("click",function(){for(var a="",d=0;d<b.$listdata_arr.length;d++)a+=b.$listdata_arr[d].id+",";c.attr("data-ids",a),b.options.backdatainfo(c,b.$listdata_arr)!==!1&&b.hide()}))),this}};var e=a.fn[b];a.fn[b]=function(c){return this.each(function(){var e=a(this),f=e.data("selectPlugsData"),g=a.fn[b].pluginData[f],h="object"==typeof c&&c;h.reset?flag=!0:g||(flag=!0),flag&&(f=a.fn[b].pluginData.index++,a.fn[b].pluginData[f]=new d(this,h),e.data("selectPlugsData",f),g=a.fn[b].pluginData[f]),g.initdata().bindEvent().show()})},a.fn[b].pluginData={index:0},a.fn[b].Constructor=b,a.fn[b].noConflict=function(){return a.fn[b]=e,this},a(document).ready(function(){a('[data-plug="'+b+'"]').each(function(){var c=a(this),d=this.dataset;a.fn[b].call(c,d)})}),d.version="1.0.0"}($);
